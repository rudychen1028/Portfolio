# 資料夾的結構：每個節點的 slurm.conf 放在 /etc/slurm/ 下

# 遠端節點清單
REMOTE_NODES=(
    "root@hpc-qdr4"
    "root@slurm-ui01"
    "root@slurm-ui02"
    "root@slurm-ui03"
    "root@slurm-ui-asiop"
    "root@bioswan-dev"
    "root@hp-teslav01"
    "root@hp-teslav02"
    "root@hp-teslav03"
    "root@hp-teslav04"
    "root@hp-teslaa01"
    "root@hp-teslaa03"
    "root@sma-wn01"
    "root@sma-wn02"
    "root@hpa-wn01"
    "root@hpa-wn02"
    "root@hpa-wn03"
    "root@hpa-wn04"
    "root@as-wn621"
    "root@as-wn622"
    "root@as-wn623"
    "root@as-wn624"
    "root@as-wn625"
    "root@as-wn626"
    "root@as-wn627"
    "root@as-wn628"
    "root@as-wn629"
    "root@as-wn630"
    "root@as-wn631"
    "root@as-wn632"
    "root@smwn001"
    "root@smwn002"
    "root@smwn003"
    "root@smwn004"
    "root@smwn005"
    "root@smwn006"
    "root@smwn007"
    "root@smwn008"
    "root@smwn009"
    "root@smwn010"
    "root@smwn011"
    "root@smwn012"
    "root@smwn013"
    "root@smwn014"
    "root@smwn015"
    "root@smwn016"
    "root@smwn017"
    "root@smwn018"
    "root@smwn019"
    "root@smwn020"
    "root@smwn021"
    "root@smwn022"
    "root@smwn023"
    "root@smwn024"
    "root@smwn025"
    "root@smwn026"
    "root@smwn027"
    "root@smwn028"
    "root@smwn029"
    "root@smwn030"
    "root@smwn031"
    "root@smwn032"
    "root@smwn033"
    "root@smwn034"
    "root@smwn035"
    "root@smwn036"
    "root@smwn037"
    "root@smwn038"
    "root@smwn039"
    "root@smwn040"
    "root@smwn041"
    "root@smwn042"
    "root@smwn043"
    "root@smwn044"
    "root@smwn045"
    "root@smwn046"
    "root@smwn047"
    "root@smwn048"
    "root@smwn049"
    "root@smwn050"
    "root@smwn051"
    "root@smwn052"
    "root@smwn053"
    "root@smwn054"
    "root@smwn055"
    "root@smwn056"
    "root@smwn057"
    "root@smwn058"
    "root@smwn059"
    "root@smwn060"
    "root@smwn061"
    "root@smwn062"
    "root@smwn063"
    "root@smwn064"
    "root@smwn065"
    "root@smwn066"
    "root@smwn067"
    "root@smwn068"
    "root@smwn069"
    "root@smwn070"
    "root@smwn071"
    "root@smwn072"
    "root@smwn073"
    "root@smwn074"
    "root@smwn075"
    "root@smwn076"
    "root@smwn077"
    "root@smwn078"
    "root@smwn079"
    "root@smwn080"
    "root@smwn081"
    "root@smwn082"
    "root@smwn083"
    "root@smwn084"
    "root@smwn085"
    "root@smwn086"
    "root@smwn087"
    "root@smwn088"
    "root@smwn089"
    "root@smwn090"
    "root@smwn091"
    "root@smwn092"
    "root@hpa-wn05"
    "root@hpa-wn06"
    "root@hpa-wn07"
    "root@hpa-wn08"
    "root@hpa-wn09"
    "root@hpa-wn10"
    "root@hpa-wn11"
    "root@hpa-wn12"
    "root@hpa-wn13"
    "root@hpa-wn14"
)

#REMOTE_NODES=(
#    "root@hpa-wn05"
#    "root@hpa-wn06"
#    "root@hpa-wn07"
#    "root@hpa-wn08"
#    "root@hpa-wn09"
#    "root@hpa-wn10"
#    "root@hpa-wn11"
#    "root@hpa-wn12"
#    "root@hpa-wn13"
#    "root@hpa-wn14"
#)


# 複製 slurm.conf 到遠端節點
for NODE in "${REMOTE_NODES[@]}"; do
    # 設定 slurm.conf 路徑
    SLURM_CONF_PATH="/etc/slurm/"

    echo "Copying slurm.conf to $NODE:$SLURM_CONF_PATH"

    # 使用 ssh-copy-id 複製 slurm.conf，這樣不需要手動輸入密碼
    ssh-copy-id -i /asgc_ui_home/rudychen/.ssh/newops "$NODE" > /dev/null 2>&1

    # 複製 slurm.conf，timeout 20 秒
    scp -o StrictHostKeyChecking=no -i /asgc_ui_home/rudychen/.ssh/newops /asgc_ui_home/rudychen/slurm/slurm.conf "$NODE":"$SLURM_CONF_PATH"

    if [ $? -eq 0 ]; then
        echo "Success!"
    else
        echo "Failed!"
    fi
done
